<mat-toolbar class="theme-navbar fixed top-0 left-0 right-0 z-50 shadow-2xl border-b">

  <div class="flex items-center justify-between w-full max-w-7xl mx-auto px-6 py-3">

    <!-- LEFT : LOGO -->
    <a routerLink="/" class="flex items-center gap-3 group">
      <div class="text-4xl font-black tracking-tighter theme-heading
                  bg-gradient-to-r from-[color:var(--heading)] to-[color:var(--accent)]
                  bg-clip-text text-transparent">
        EcoBazaar
      </div>
    </a>

    <!-- CENTER : DESKTOP NAV -->
   <nav class="hidden lg:flex items-center gap-10 flex-1 justify-center">

  <!-- ALWAYS SHOW -->
  <a routerLink="/"
     routerLinkActive="active-link"
     [routerLinkActiveOptions]="{ exact: true }"
     class="nav-link text-lg">
    Home
  </a>

  <!-- ALWAYS SHOW SHOP -->
 <a *ngIf="!auth.isSeller() && !auth.isAdmin()"
   routerLink="/products"
   routerLinkActive="active-link"
   class="nav-link text-lg">
  Shop
</a>



  <!-- AFTER LOGIN USER ONLY -->
  <ng-container *ngIf="auth.isLoggedIn()">

    <ng-container *ngIf="auth.isUser()">

      <a routerLink="/cart"
         routerLinkActive="active-link"
         class="nav-link text-lg relative">

        Cart

        <span *ngIf="cartCount > 0"
              class="absolute -top-3 -right-6 bg-yellow-400 text-black text-xs font-bold px-3 py-1 rounded-full animate-pulse shadow-lg">
          {{ cartCount }}
        </span>

      </a>

      <a routerLink="/dashboard"
         routerLinkActive="active-link"
         class="nav-link text-lg">
        My Impact
      </a>
    
    </ng-container>
   <ng-container *ngIf="auth.isAdmin()">

  <a routerLink="/admin"
     routerLinkActive="active-link"
     class="nav-link text-lg">
    Admin Panel
  </a>


</ng-container>
<ng-container *ngIf="auth.isSeller()">

  <a routerLink="/seller/dashboard"
     routerLinkActive="active-link"
     class="nav-link text-lg">
    Seller Dashboard
  </a>

  <a routerLink="/seller/product"
     routerLinkActive="active-link"
     class="nav-link text-lg">
    Add Product
  </a>

</ng-container>
  </ng-container>

</nav>


    <!-- RIGHT SIDE -->
    <div class="flex items-center gap-6">

      <!-- Desktop Controls -->
      <div class="hidden lg:flex items-center gap-6">

  <!-- â­ BEFORE LOGIN -->
  <ng-container *ngIf="!auth.isLoggedIn()">
     <button mat-stroked-button
            [matMenuTriggerFor]="themeMenu"
            class="px-6 py-2 rounded-full font-semibold theme-text border">
      ğŸŒˆ Themes
    </button>
    <a routerLink="/login">
      <button mat-stroked-button
              class="px-6 py-2 rounded-full font-semibold theme-text border">
        Login
      </button>
    </a>

    <a routerLink="/register">
      <button mat-raised-button
              class="px-6 py-2 rounded-full font-semibold">
        Join Free
      </button>
    </a>

  </ng-container>

  <!-- â­ AFTER LOGIN -->
  <ng-container *ngIf="auth.isLoggedIn()">

    <button mat-stroked-button
            [matMenuTriggerFor]="themeMenu"
            class="px-6 py-2 rounded-full font-semibold theme-text border">
      ğŸŒˆ Themes
    </button>

    <div class="flex items-center gap-6 border-l pl-6 theme-text">
       
      <div class="text-right">
        <p class="opacity-75 text-sm">Welcome back</p>
        <p class="font-bold text-lg">{{ auth.getName() }}</p>
      </div>

      <button mat-icon-button [matMenuTriggerFor]="userMenu">
        <mat-icon>account_circle</mat-icon>
      </button>

    </div>

  </ng-container>

</div>


      <!-- MOBILE HAMBURGER -->
      <button
  mat-icon-button
  class="mobile-hamburger"
  (click)="mobileMenuOpen = !mobileMenuOpen">

        <mat-icon>menu</mat-icon>
      </button>

    </div>

  </div>

  <!-- MOBILE SIDEMENU -->
  <div *ngIf="mobileMenuOpen"
     class="lg:hidden absolute top-full left-0 w-full theme-navbar shadow-xl p-6 flex flex-col gap-4">
<div *ngIf="auth.isLoggedIn()"
     class="pb-4 mb-4 border-b theme-text flex flex-col">

  <span class="text-sm opacity-70">Welcome back</span>

  <span class="text-xl font-black tracking-wide">
    {{ auth.getName() }}
  </span>

</div>

  <!-- ALWAYS -->
  <a routerLink="/" class="nav-link text-lg" (click)="mobileMenuOpen=false">
    Home
  </a>
<a *ngIf="!auth.isSeller() && !auth.isAdmin()"
   routerLink="/products"
   class="nav-link text-lg"
   (click)="mobileMenuOpen=false">
  Shop
</a>


  <a class="nav-link text-lg cursor-pointer"
       [matMenuTriggerFor]="themeMenu">
      Themes
    </a>
    
  <!-- BEFORE LOGIN -->
  <ng-container *ngIf="!auth.isLoggedIn()">

    <a routerLink="/login" (click)="mobileMenuOpen=false">
  <button mat-stroked-button class="w-full py-3 rounded-xl">
    Login
  </button>
</a>
<a routerLink="/register" (click)="mobileMenuOpen=false">
  <button mat-raised-button class="w-full py-3 rounded-xl">
    Join Free
  </button>
</a>


  </ng-container>

  <!-- AFTER LOGIN -->
  <ng-container *ngIf="auth.isLoggedIn()">

  <!-- â­ NORMAL USER -->
  <ng-container *ngIf="auth.isUser()">

    <a routerLink="/cart" class="nav-link text-lg" (click)="mobileMenuOpen=false">
      Cart
    </a>

    <a routerLink="/dashboard" class="nav-link text-lg" (click)="mobileMenuOpen=false">
      My Impact
    </a>

  </ng-container>
<ng-container *ngIf="auth.isSeller()">

  <a routerLink="/seller/dashboard"
     class="nav-link text-lg"
     (click)="mobileMenuOpen=false">
     Seller Dashboard
  </a>

  <a routerLink="/seller/product"
     class="nav-link text-lg"
     (click)="mobileMenuOpen=false">
     Add Product
  </a>

</ng-container>

  <!-- â­ ADMIN -->
  <ng-container *ngIf="auth.isAdmin()">

    <a routerLink="/admin" class="nav-link text-lg" (click)="mobileMenuOpen=false">
      Admin Panel
    </a>

  </ng-container>

  <!-- Logout for everyone -->
  <a class="nav-link text-lg cursor-pointer"
     (click)="logout(); mobileMenuOpen=false">
    Logout
  </a>

</ng-container>


</div>


</mat-toolbar>

<!-- â­ USER MENU â­ -->
<mat-menu #userMenu="matMenu" class="mt-4">

  <button mat-menu-item routerLink="/dashboard" *ngIf="auth.isUser() && !auth.isSeller()">
    <mat-icon>dashboard</mat-icon> My Impact
  </button>

  <button mat-menu-item routerLink="/seller/dashboard" *ngIf="auth.isSeller()">
    <mat-icon>storefront</mat-icon> Seller Dashboard
  </button>

  <button mat-menu-item routerLink="/admin" *ngIf="auth.isAdmin()">
    <mat-icon>shield</mat-icon> Admin Panel
  </button>

  <mat-divider></mat-divider>

    <!-- â­ THEME MENU â­ -->
<mat-menu #themeMenu="matMenu" xPosition="before" class="px-2 py-2">

  <div class="flex flex-col gap-1 w-48 p-2">

    <button mat-menu-item (click)="setTheme('theme-snow')" class="theme-menu-item">â„ Snow</button>
    <button mat-menu-item (click)="setTheme('theme-azure')" class="theme-menu-item">ğŸ”µ Azure</button>
    <button mat-menu-item (click)="setTheme('theme-forest')" class="theme-menu-item">ğŸŒ² Forest</button>
    <button mat-menu-item (click)="setTheme('theme-rose')" class="theme-menu-item">ğŸŒ¸ Rose</button>

    <mat-divider></mat-divider>

    <button mat-menu-item (click)="setTheme('theme-neon-pink')" class="theme-menu-item">ğŸ’– Neon Pink</button>
    <button mat-menu-item (click)="setTheme('theme-neon-blue')" class="theme-menu-item">ğŸ’ Neon Blue</button>

    <mat-divider></mat-divider>
    <button mat-menu-item (click)="setTheme('theme-dark-purple')" class="theme-menu-item">ğŸŸ£ Dark Purple</button>
    <button mat-menu-item (click)="setTheme('theme-dark-ocean')" class="theme-menu-item">ğŸŒŠ Dark Ocean</button>
    <button mat-menu-item (click)="setTheme('theme-amoled')" class="theme-menu-item">ğŸ–¤ Amoled Black</button>

  </div>

</mat-menu>



  <mat-divider></mat-divider>

  <button mat-menu-item (click)="logout()">
    <mat-icon>logout</mat-icon> Logout
  </button>

</mat-menu>


<!-- â­ PAGE WRAPPER â­ -->
<div class="pt-16 min-h-screen theme-background relative overflow-hidden">

  <div class="absolute inset-0 -z-10 pointer-events-none">
    <div class="absolute top-10 -left-20 w-96 h-96 rounded-full blur-3xl animate-pulse"
         [style.background]="'var(--orb-1)'"></div>

    <div class="absolute bottom-0 right-0 w-80 h-80 rounded-full blur-3xl animate-pulse delay-1000"
         [style.background]="'var(--orb-2)'"></div>

    <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-72 h-72 rounded-full blur-3xl animate-pulse delay-500"
         [style.background]="'var(--orb-3)'"></div>
  </div>

  <router-outlet></router-outlet>

</div>
